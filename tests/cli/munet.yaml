version: 1

cli:
  commands:
    - name: ""
      exec: "bash -c 'echo name:%NAME% echo:{}'"
      help-format: "[HOST ...] ECHO-BACK"
      help: "echo ECHO-BACK"
    - name: "ls"
      exec: "ls {}"
      format: "ls [HOST ...] OBJECT [OBJECT ...]"
      help: "get an `ls -l` on OBJECTs on the given HOST[s]"
    - name: "count"
      exec: "bash -c 'for ((i=0; i<10; i++)); do echo $i; sleep 1; done'"
      format: "count HOST [HOST ...]"
      help: "Open terminals on HOST[s] performing count to 10"
      new-window: true

    - name: "toplevel-ip"
      exec: "ip {}"
      format: "ip IPARGS"
      help: "Run ip command in top-level namespace"
      top-level: true

topology:
  networks:
    - name: net0
      ip: auto
  nodes:
    - name: r1
      connections: ["net0", "r2"]
      cmd: |
        ip addr show
        # Adding the line below causes downstream failures, looks due to failed
        # cleanup. Need to debug why cleanup fails in this case.
        tail -f /dev/null
    - name: r2
      image: docker.io/labn/docker-ci-test:20.04
      connections: ["net0", "r1"]
      cmd: |
        ip addr show
        tail -f /dev/null
